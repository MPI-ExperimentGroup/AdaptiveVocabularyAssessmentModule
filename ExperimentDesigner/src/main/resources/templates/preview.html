<!DOCTYPE html>
<!--
Copyright (C) 2021 Max Planck Institute for Psycholinguistics, Nijmegen

This program is free software; you can redistribute it and/or
modify it under the terms of the GNU General Public License
as published by the Free Software Foundation; either version 2
of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-->
<!--
 * @since 08 December 2021 14:45 PM (creation date)
 * @author Peter Withers <peter.withers@mpi.nl>
-->
<html>

<head>
    <title>Wizard Preview</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="./designer.css" />
    <script src="./webjars/jquery/jquery.min.js"></script>
    <script>
        // TODO: read these availableTemplates from disk via the controller
        const availableTemplates = {
            'mpistairs4words2': {
                'english_name': 'Stairs4Words (receptive vocabulary)',
                'dutch_name': 'Stairs4Words',
                'duration': 7,
                'category': 'Linguistic experience',
                'english_description': 'Adaptive vocabulary test based on a Yes/No decision task.',
                'dutch_description': 'Replace with Dutch description'
            },
            'mpiantonymsproduction': {
                'english_name': 'Antonym production (productive vocabulary)',
                'dutch_name': 'Tegenstellingen',
                'duration': 5,
                'category': 'Linguistic experience',
                'english_description': 'Participants hear a spoken word and are instructed to produce its antonym.',
                'dutch_description': 'Replace with Dutch description'
            },
            'mpiidioms': {
                'english_name': 'Idiom recognition',
                'dutch_name': 'Uitdrukkingen',
                'duration': 3,
                'category': 'Linguistic experience',
                'english_description': 'Participants select the correct meaning for an idiomatic expression among four alternatives.',
                'dutch_description': 'Replace with Dutch description'
            },
            'mpispellingtest': {
                'english_name': 'Spelling test',
                'dutch_name': 'Spellingtest',
                'duration': 5,
                'category': 'Linguistic experience',
                'english_description': 'Participants identify incorrectly spelled words in a list of 60 words (half of which are spelled incorrectly).',
                'dutch_description': 'Replace with Dutch description'
            },
            'mpiauteurstest': {
                'english_name': 'Author recognition test',
                'dutch_name': 'Auteurstest',
                'duration': 5,
                'category': 'Linguistic experience',
                'english_description': 'Participants identify fictional writers in a list of 132 names (90 are writers).',
                'dutch_description': 'Replace with Dutch description'
            },
            'mpiprescriptivegrammar': {
                'english_name': 'Prescriptive grammar test',
                'dutch_name': 'Grammaticatest',
                'duration': 10,
                'category': 'Linguistic experience',
                'english_description': 'Participants carry out grammaticality judgements on spoken sentences featuring morpho-syntactic constructions known to be difficult for adult speakers of Dutch (e.g., ik vs. mij, als vs. dan, ze vs. hun).',
                'dutch_description': 'Replace with Dutch description'
            },
            'mpiausimplereactiontime': {
                'english_name': 'Auditory simple reaction time test',
                'dutch_name': 'Auditieve reactietijdtaak 1',
                'duration': 3,
                'category': 'Processing speed',
                'english_description': 'Participants respond as quickly as possible to the presentation of a beep by pressing the space bar.',
                'dutch_description': 'Replace with Dutch description'
            },
            'mpiauchoicereactiontime': {
                'english_name': 'Auditory choice reaction time test',
                'dutch_name': 'Auditieve reactietijdtaak 2',
                'duration': 4,
                'category': 'Processing speed',
                'english_description': 'Participants respond as quickly as possible to the presentation of one of two beeps (high or low) by pressing one of two buttons.',
                'dutch_description': 'Replace with Dutch description'
            },
            'mpilettercomparison': {
                'english_name': 'Letter comparison test',
                'dutch_name': 'Lettervergelijkingstest',
                'duration': 5,
                'category': 'Processing speed',
                'english_description': 'Participants indicate as quickly as possible whether two letter strings are identical by pressing one of two buttons.',
                'dutch_description': 'Replace with Dutch description'
            },
            'mpivisimplereactiontime': {
                'english_name': 'Visual simple reaction time test',
                'dutch_name': 'Visuele reactietijdtaak 1',
                'duration': 3,
                'category': 'Processing speed',
                'english_description': 'Participants respond as quickly as possible to the presentation of a geometrical shape by pressing the space bar.',
                'dutch_description': 'Replace with Dutch description'
            },
            'mpivichoicereactiontime': {
                'english_name': 'Visual choice reaction time test',
                'dutch_name': 'Visuele reactietijdtaak 2',
                'duration': 4,
                'category': 'Processing speed',
                'english_description': 'Participants respond as quickly as possible to the presentation of one of two geometrical shapes by pressing one of two buttons.',
                'dutch_description': 'Replace with Dutch description'
            },
            'mpidigitspan': {
                'english_name': 'Digit span',
                'dutch_name': 'Cijferreeksen',
                'duration': 7,
                'category': 'Working memory',
                'english_description': 'Participants are instructed to recall sequences of digits in the order they were encountered (forward version) or in the reversed order (backward version).',
                'dutch_description': 'Replace with Dutch description'
            },
            'mpicorsi': {
                'english_name': 'Corsi block clicking',
                'dutch_name': 'Corsi block clicking test',
                'duration': 7,
                'category': 'Working memory',
                'english_description': 'Participants are instructed to recall sequences of identical spatially separated blocks by clicking on them in the order they were encountered (forward version) and in the reversed order (backward version).',
                'dutch_description': 'Replace with Dutch description'
            },
            'mpipicturenaming': {
                'english_name': 'Picture naming',
                'dutch_name': 'Plaatjes benoemen',
                'duration': 7,
                'category': 'Word production',
                'english_description': 'Participants name pictures whose names vary in word frequency as quickly as possible.',
                'dutch_description': 'Replace with Dutch description'
            },
            'mpirapidautomatizednaming': {
                'english_name': 'Rapid automatized naming',
                'dutch_name': 'Plaatjesseries benoemen',
                'duration': 7,
                'category': 'Word production',
                'english_description': 'Participants are familiarized with four sets of five objects whose names vary orthogonally in frequency and neighbourhood density. Each object set is arranged in an array consisting of five rows of six objects. Participants are instructed to name all objects in the array as quickly as possible.',
                'dutch_description': 'Replace with Dutch description'
            },
            'mpiverbalfluency': {
                'english_name': 'Verbal fluency',
                'dutch_name': 'Woorden opnoemen',
                'duration': 5,
                'category': 'Word production',
                'english_description': 'Participants name as many words as possible belonging to pre-specified categories (semantic part) and starting with letters provided ahead of time (phonological version) within one minute.',
                'dutch_description': 'Replace with Dutch description'
            },
            'mpimaximalspeechrate': {
                'english_name': 'Maximal speech rate',
                'dutch_name': 'Maximal speech rate',
                'duration': 3,
                'category': 'Word production',
                'english_description': 'Participants are instructed to name the months of the year as quickly as possible.',
                'dutch_description': 'Replace with Dutch description'
            },
            'mpiwords2phrases': {
                'english_name': 'Phrase generation',
                'dutch_name': 'Woorden en phrasen produceren',
                'duration': 10,
                'category': 'Sentence production',
                'english_description': 'Participants are familiarized with a set of 16 common objects. These objects are presented in noun/adjectival phrases of increasing difficulty, which participants are instructed to name as quickly as possible.',
                'dutch_description': 'Replace with Dutch description'
            },
            'mpisentencegeneration': {
                'english_name': 'Sentence generation (structured)',
                'dutch_name': 'Zinnen maken 1',
                'duration': 12,
                'category': 'Sentence production',
                'english_description': 'Participants describe scenes depicting transitive actions (intransitives serve as fillers) as quickly as possible using pre-specified verbal material. Colour-coding of the characters in the scenes coerces the production of active and passive sentences.',
                'dutch_description': 'Replace with Dutch description'
            },
            'mpikonopka': {
                'english_name': 'Sentence generation (unstructured)',
                'dutch_name': 'Zinnen maken 2',
                'duration': 10,
                'category': 'Sentence production',
                'english_description': 'Participants describe scenes depicting transitive and intransitive actions and are free in their choice of words and syntactic structure/voice.',
                'dutch_description': 'Replace with Dutch description'
            },
            'mpispontaneousspeech': {
                'english_name': 'Spontaneous speech',
                'dutch_name': 'Spontane spraak',
                'duration': 4,
                'category': 'Sentence production',
                'english_description': 'Participants speak freely for one minute about three topics provided ahead of time.',
                'dutch_description': 'Replace with Dutch description'
            },
            'mpinonwordmonitoring': {
                'english_name': 'Monitoring in noise in non-word lists',
                'dutch_name': 'Woorden in ruis',
                'duration': 10,
                'category': 'Word comprehension',
                'english_description': 'Participants monitor lists of non-words, presented in increasing levels of noise, for the occurrence of probe non-words, presented in the clear at the beginning of a trial.',
                'dutch_description': 'Replace with Dutch description'
            },
            'mpirhymes': {
                'english_name': 'Rhyme judgement',
                'dutch_name': 'Rijm herkennen',
                'duration': 5,
                'category': 'Word comprehension',
                'english_description': 'Participants are presented with two non-words in succession and are instructed to judge as quickly as possible whether both non-words rhyme.',
                'dutch_description': 'Replace with Dutch description'
            },
            'mpilexicaldecision': {
                'english_name': 'Auditory lexical decision',
                'dutch_name': 'Woorden herkennen',
                'duration': 7,
                'category': 'Word comprehension',
                'english_description': 'Participants judge the lexicality status of an auditorily presented target word as quickly as possible.',
                'dutch_description': 'Replace with Dutch description'
            },
            'mpicategorisation': {
                'english_name': 'Semantic categorization',
                'dutch_name': 'Woorden categoriseren',
                'duration': 5,
                'category': 'Word comprehension',
                'english_description': 'Participants judge as quickly as possible whether an auditorily presented target word belongs to a pre-specified semantic category.',
                'dutch_description': 'Replace with Dutch description'
            },
            'mpisentencemonitoring': {
                'english_name': 'Monitoring in noise in sentences',
                'dutch_name': 'Zinnen in ruis',
                'duration': 10,
                'category': 'Sentence comprehension',
                'english_description': 'Participants monitor predictable and non-predictable sentences, presented in increasing levels of noise, for the occurrence of probe words, presented in the clear at the beginning of a trial.',
                'dutch_description': 'Replace with Dutch description'
            },
            'mpiwerkwoorden': {
                'english_name': 'Verb semantics activation during sentence comprehension',
                'dutch_name': 'Plaatjeskliktest 1',
                'duration': 7,
                'category': 'Sentence comprehension',
                'english_description': 'Participants are presented with two objects on the computer screen and a spoken sentence containing a target noun, which refers to one of the two objects. In half of the sentences, the target is predictable based on verb semantics. Participants indicate by button press which of the two objects is referred to in the sentence. On predictable trials, participants may respond before target noun onset.',
                'dutch_description': 'Replace with Dutch description'
            },
            'mpigrammaticalgendercues1': {
                'english_name': 'Gender cue identification',
                'dutch_name': 'Plaatjes-lidwoord test',
                'duration': 10,
                'category': 'Sentence comprehension',
                'english_description': 'Participants indicate for 80 objects whether their names are de- or het-nouns (both common gender in English).',
                'dutch_description': 'Replace with Dutch description'
            },
            'mpigrammaticalgendercues2': {
                'english_name': 'Gender cue activation during sentence comprehension',
                'dutch_name': 'Plaatjeskliktest 2',
                'duration': 10,
                'category': 'Sentence comprehension',
                'english_description': 'Participants are presented with two objects (the same as in the Gender cue identification test) on the computer screen and a spoken sentence containing a target noun, which refers to one of the two objects. In half of the sentences, the target is predictable based on a determiner expressing the grammatical gender of the target noun. Participants indicate by button press which of the two objects is referred to in the sentence. On predictable trials, participants may respond before target noun onset.',
                'dutch_description': 'Replace with Dutch description'
            },
            'mpiselfpacedreading': {
                'english_name': 'Self-paced reading',
                'dutch_name': 'Zinnen lezen',
                'duration': 5,
                'category': 'Sentence comprehension',
                'english_description': 'Participants read sentences of varying syntactic complexity in a self-paced fashion.',
                'dutch_description': 'Replace with Dutch description'
            },
            'mpidaivt': {
                'english_name': 'Dutch auditory & image vocabulary test',
                'dutch_name': 'Woordenschattest met plaatjes',
                'duration': '12',
                'category': 'Extra tests',
                'english_description': 'Participants hear a spoken word and select the picture associated with its meaning among four alternatives.',
                'dutch_description': 'Replace with Dutch description'
            },
            'mpimars': {
                'english_name': 'Matrix reasoning test',
                'dutch_name': 'Non-verbale IQ test',
                'duration': '8',
                'category': 'Extra tests',
                'english_description': 'Participants indicate which of four possible shapes completes a matrix of geometric patterns.',
                'dutch_description': 'Replace with Dutch description'
            },
            'mpibq5bfi2': {
                'english_name': 'BIG 5 personality traits',
                'dutch_name': 'BIG 5 vragenlijst',
                'duration': '5',
                'category': 'Extra tests',
                'english_description': 'Participants rate personality statements.',
                'dutch_description': 'Replace with Dutch description'
            },
            'mpiwoordenschattest': {
                'english_name': 'Receptive vocabulary test (multiple choice)',
                'dutch_name': 'Woordenschattest (multiple choice)',
                'duration': '7',
                'category': 'Extra tests',
                'english_description': 'Participants read target words (varying in difficulty) and select the correct meaning among four written alternatives.',
                'dutch_description': 'Replace with Dutch description'
            },
            'mpioneminutereading': {
                'english_name': 'One minute reading test',
                'dutch_name': 'Een-minute leesttest',
                'duration': '3',
                'category': 'Extra tests production',
                'english_description': 'Participants read as many words (increasing in difficulty) as possible within one minute.',
                'dutch_description': 'Replace with Dutch description'
            },
            'mpiflamingo': {
                'english_name': 'Story reading test',
                'dutch_name': 'Verhaal lezen',
                'duration': '5',
                'category': 'Extra tests production',
                'english_description': 'Participants read as much as possible of a story within three minutes.',
                'dutch_description': 'Replace with Dutch description'
            }
        };
        $(document).ready(function () {
            var $templateSelector = $("#templateSelector");
            $.each(availableTemplates, function (templateId, templateEntry) {
                $templateSelector.append($("<option />").val(templateId).text(templateEntry.english_name));
            });
        });
    </script>
    <style>
        .inspectPanel {
            vertical-align: top;
        }

        .presenterPanel {
            min-height: 100px;
            background: lightblue;
            margin: 10px;
            padding: 10px;
        }
    </style>
</head>
<div id="header">
    <h1>Frinex Experiment Designer</h1>
</div>
<table id="menu" class="menu">
    <!-- TODO: move this header and menu into a thymeleaf template -->
    <tr>
        <td><a th:attr="class=${detailType eq 'preview' ? 'sel' : 'unsel'}"
                th:href="${contextPath} + '/preview'">Preview Wizard</a></td>
        <td><a th:attr="class=${detailType eq 'wizard' ? 'sel' : 'unsel'}"
                th:href="${contextPath} + '/wizard'">Experiment Wizard</a></td>
        <td><a th:attr="class=${detailType eq 'experiments' ? 'sel' : 'unsel'}"
                th:href="${contextPath} + '/experiments'">Experiment List</a></td>
        <td><a th:attr="class=${detailType eq 'translations' ? 'sel' : 'unsel'}"
                th:href="${contextPath} + '/translations'">Translations</a></td>
        <td><a th:href="${contextPath} + '/edituser'">User Profile</a></td>
        <td>
            <form th:action="@{/logout}" method="post"><input type="submit" value="Sign Out" /></form>
        </td>
    </tr>
</table>

<body>
    <select id="templateSelector">
        <option value="template_example">template_example</option>
    </select>
    <table>
        <tr>
            <td id="inspectPanel" class="inspectPanel"></td>
            <td class="previewPanel">
                <!-- TODO: set up the previewframe to return the template files <iframe id="previewFrame" src="previewframe" scrolling="no" -->
                <iframe id="previewFrame" src="./template_example/index.html" scrolling="no"
                    style="border:1; overflow:hidden; height:95vh; width:80vw;" align="right"></iframe>
            </td>
        </tr>
    </table>
    <script>
        function initTemplateWizard() {
            if (typeof $("iframe")[0].contentWindow.applicationStates !== 'undefined') {
                $.each($("iframe")[0].contentWindow.applicationStates, function (presenterName, presenterTitle) {
                    console.log(presenterName, presenterTitle);
                    $("#inspectPanel").append("<div class='presenterPanel' id='" + presenterName + "Panel'>" + presenterTitle + "</div>");
                    $("#" + presenterName + "Panel").click(function () {
                        $("iframe")[0].contentWindow.requestState(presenterName)
                    });
                });
                $("iframe")[0].contentWindow.templateFeatureHandler = function(presenterName, domId, featureAttribute, jsonPath, instructionalText) {
                    console.log("templateFeatureHandler: ", presenterName, domId, featureAttribute, jsonPath, instructionalText);
                    $("iframe").contents().find("#" + domId).focusout(function() {
                        console.log("focusout: ", presenterName, domId, $("iframe").contents().find("#" + domId).html());
                    })
                    $("iframe").contents().find("#" + domId).attr("contenteditable","true");
                }
            } else {
                // TODO: solve this loading issue and then remove this setTimeout
                setTimeout(function () {
                    initTemplateWizard();
                }, 1000);
            }
        }
        $('#previewFrame').on('load', function () {
            console.log("previewFrame loaded");
            initTemplateWizard();
        });
    </script>
</body>

</html>
